{% extends "base.html" %}

{% block title %}üöÄ Real-Time Exoplanet Analysis - Space Data Processing{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="hero-section bg-gradient-dark text-white p-5 rounded-3">
                <h1 class="display-4 fw-bold">üöÄ Real-Time Space Data Processing</h1>
                <p class="lead">Live exoplanet discovery and analysis from space missions</p>
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="stat-card bg-success bg-opacity-20 rounded p-3 text-center">
                            <h3 class="text-white mb-1" id="live-processed">0</h3>
                            <small class="text-white-50">Live Processed</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-warning bg-opacity-20 rounded p-3 text-center">
                            <h3 class="text-white mb-1" id="discoveries-today">0</h3>
                            <small class="text-white-50">Discoveries Today</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-info bg-opacity-20 rounded p-3 text-center">
                            <h3 class="text-white mb-1" id="habitable-found">0</h3>
                            <small class="text-white-50">Potentially Habitable</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-danger bg-opacity-20 rounded p-3 text-center">
                            <h3 class="text-white mb-1" id="anomalies-detected">0</h3>
                            <small class="text-white-50">Anomalies Detected</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Real-Time Processing Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0">üõ∞Ô∏è Live Space Data Processing</h4>
                    <small>Real-time analysis from Kepler, TESS, and K2 missions</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Live Processing Status -->
                        <div class="col-md-4">
                            <div class="processing-status">
                                <h5 class="text-success">üü¢ Processing Status</h5>
                                <div class="status-indicators">
                                    <div class="status-item">
                                        <span class="status-dot bg-success"></span>
                                        <span>Kepler Data Stream</span>
                                        <span class="badge bg-success">Active</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-dot bg-success"></span>
                                        <span>TESS Data Stream</span>
                                        <span class="badge bg-success">Active</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-dot bg-warning"></span>
                                        <span>K2 Data Stream</span>
                                        <span class="badge bg-warning">Limited</span>
                                    </div>
                                    <div class="status-item">
                                        <span class="status-dot bg-success"></span>
                                        <span>ML Models</span>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Processing Speed -->
                        <div class="col-md-4">
                            <div class="processing-metrics">
                                <h5 class="text-info">‚ö° Processing Speed</h5>
                                <div class="metric-item">
                                    <span>Data Rate:</span>
                                    <span class="badge bg-info" id="data-rate">2.3 GB/hour</span>
                                </div>
                                <div class="metric-item">
                                    <span>Analysis Speed:</span>
                                    <span class="badge bg-success" id="analysis-speed">1,247 candidates/min</span>
                                </div>
                                <div class="metric-item">
                                    <span>Model Accuracy:</span>
                                    <span class="badge bg-warning" id="model-accuracy">83.5%</span>
                                </div>
                                <div class="metric-item">
                                    <span>Uptime:</span>
                                    <span class="badge bg-primary" id="uptime">99.7%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Discoveries -->
                        <div class="col-md-4">
                            <div class="recent-discoveries">
                                <h5 class="text-warning">üåü Recent Discoveries</h5>
                                <div class="discovery-feed" id="discovery-feed">
                                    <div class="discovery-item">
                                        <span class="discovery-time">2m ago</span>
                                        <span class="discovery-text">Kepler-442b confirmed as potentially habitable</span>
                                        <span class="badge bg-success">HABITABLE</span>
                                    </div>
                                    <div class="discovery-item">
                                        <span class="discovery-time">5m ago</span>
                                        <span class="discovery-text">TESS-1234c detected with 0.8 R‚äï radius</span>
                                        <span class="badge bg-info">CANDIDATE</span>
                                    </div>
                                    <div class="discovery-item">
                                        <span class="discovery-time">8m ago</span>
                                        <span class="discovery-text">K2-456b shows unusual transit pattern</span>
                                        <span class="badge bg-warning">ANOMALY</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Processing Table -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üìä Live Batch Processing Queue</h4>
                    <small>Real-time processing of space mission data</small>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Mission</th>
                                    <th>Candidate ID</th>
                                    <th>Period (days)</th>
                                    <th>Radius (R‚äï)</th>
                                    <th>Status</th>
                                    <th>Confidence</th>
                                    <th>Processing Time</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody id="batch-processing-table">
                                <!-- Real-time data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Space Mission Data Sources -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">üõ∞Ô∏è Space Mission Data Sources</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mission-card">
                                <div class="mission-header">
                                    <h5 class="text-primary">üî≠ Kepler Mission</h5>
                                    <span class="badge bg-primary">2009-2018</span>
                                </div>
                                <div class="mission-stats">
                                    <div class="stat">
                                        <span class="stat-label">Candidates:</span>
                                        <span class="stat-value" id="kepler-candidates">2,847</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Confirmed:</span>
                                        <span class="stat-value" id="kepler-confirmed">2,341</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Habitable:</span>
                                        <span class="stat-value" id="kepler-habitable">89</span>
                                    </div>
                                </div>
                                <div class="mission-status">
                                    <span class="status-dot bg-success"></span>
                                    <span>Data Stream Active</span>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mission-card">
                                <div class="mission-header">
                                    <h5 class="text-success">üõ∞Ô∏è TESS Mission</h5>
                                    <span class="badge bg-success">2018-Present</span>
                                </div>
                                <div class="mission-stats">
                                    <div class="stat">
                                        <span class="stat-label">Candidates:</span>
                                        <span class="stat-value" id="tess-candidates">4,569</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Confirmed:</span>
                                        <span class="stat-value" id="tess-confirmed">1,234</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Habitable:</span>
                                        <span class="stat-value" id="tess-habitable">156</span>
                                    </div>
                                </div>
                                <div class="mission-status">
                                    <span class="status-dot bg-success"></span>
                                    <span>Data Stream Active</span>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mission-card">
                                <div class="mission-header">
                                    <h5 class="text-warning">üåå K2 Mission</h5>
                                    <span class="badge bg-warning">2014-2018</span>
                                </div>
                                <div class="mission-stats">
                                    <div class="stat">
                                        <span class="stat-label">Candidates:</span>
                                        <span class="stat-value" id="k2-candidates">1,234</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Confirmed:</span>
                                        <span class="stat-value" id="k2-confirmed">456</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Habitable:</span>
                                        <span class="stat-value" id="k2-habitable">23</span>
                                    </div>
                                </div>
                                <div class="mission-status">
                                    <span class="status-dot bg-warning"></span>
                                    <span>Data Stream Limited</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Real-Time Charts -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìà Discovery Rate (Last 24 Hours)</h5>
                </div>
                <div class="card-body">
                    <canvas id="discoveryChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">üéØ Classification Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="classificationChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Control Panel -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0">üéÆ Control Panel</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <button class="btn btn-success btn-lg w-100 mb-3" onclick="startProcessing()">
                                <i class="fas fa-play"></i><br>
                                Start Processing
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-warning btn-lg w-100 mb-3" onclick="pauseProcessing()">
                                <i class="fas fa-pause"></i><br>
                                Pause Processing
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-info btn-lg w-100 mb-3" onclick="downloadData()">
                                <i class="fas fa-download"></i><br>
                                Download Data
                            </button>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-danger btn-lg w-100 mb-3" onclick="resetSystem()">
                                <i class="fas fa-refresh"></i><br>
                                Reset System
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.hero-section {
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
}

.status-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
}

.status-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.status-item:last-child {
    border-bottom: none;
}

.metric-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #f8f9fa;
}

.metric-item:last-child {
    border-bottom: none;
}

.discovery-feed {
    max-height: 200px;
    overflow-y: auto;
}

.discovery-item {
    display: flex;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
    animation: slideIn 0.5s ease-in;
}

.discovery-item:last-child {
    border-bottom: none;
}

.discovery-time {
    font-size: 0.8rem;
    color: #6c757d;
    margin-right: 10px;
    min-width: 50px;
}

.discovery-text {
    flex: 1;
    margin-right: 10px;
}

.mission-card {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    height: 100%;
    transition: all 0.3s ease;
}

.mission-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.mission-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.mission-stats {
    margin-bottom: 15px;
}

.stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
    border-bottom: 1px solid #f8f9fa;
}

.stat:last-child {
    border-bottom: none;
}

.stat-label {
    color: #6c757d;
    font-size: 0.9rem;
}

.stat-value {
    font-weight: bold;
    color: #495057;
}

.mission-status {
    display: flex;
    align-items: center;
    color: #28a745;
    font-weight: 500;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.table-hover tbody tr:hover {
    background-color: rgba(0,123,255,0.1);
}

.btn-lg {
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
}

.btn-lg:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.btn-lg i {
    display: block;
    margin-bottom: 10px;
    font-size: 2rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let processingInterval;
let discoveryCount = 0;
let processedCount = 0;
let habitableCount = 0;
let anomalyCount = 0;

// Sample data for real-time simulation
const sampleCandidates = [
    { mission: 'Kepler', id: 'KIC-1234567', period: 365.25, radius: 1.2, status: 'Processing', confidence: 0.85, time: '2.3s', result: 'Candidate' },
    { mission: 'TESS', id: 'TIC-2345678', period: 12.5, radius: 0.8, status: 'Completed', confidence: 0.92, time: '1.8s', result: 'Confirmed' },
    { mission: 'K2', id: 'EPIC-3456789', period: 45.2, radius: 2.1, status: 'Processing', confidence: 0.78, time: '3.1s', result: 'Candidate' },
    { mission: 'TESS', id: 'TIC-4567890', period: 8.7, radius: 1.5, status: 'Completed', confidence: 0.88, time: '2.1s', result: 'Confirmed' },
    { mission: 'Kepler', id: 'KIC-5678901', period: 156.3, radius: 0.6, status: 'Processing', confidence: 0.91, time: '2.7s', result: 'Habitable' }
];

document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    startRealTimeUpdates();
    populateBatchTable();
});

function initializeCharts() {
    // Discovery rate chart
    const ctx1 = document.getElementById('discoveryChart').getContext('2d');
    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '24:00'],
            datasets: [{
                label: 'Discoveries',
                data: [12, 19, 15, 25, 22, 18, 24],
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Discovery Rate Over Time'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Classification distribution chart
    const ctx2 = document.getElementById('classificationChart').getContext('2d');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Confirmed', 'Candidate', 'False Positive'],
            datasets: [{
                data: [45, 35, 20],
                backgroundColor: [
                    'rgb(75, 192, 192)',
                    'rgb(255, 205, 86)',
                    'rgb(255, 99, 132)'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Classification Distribution'
                }
            }
        }
    });
}

function startRealTimeUpdates() {
    processingInterval = setInterval(() => {
        updateStats();
        addNewDiscovery();
        updateBatchTable();
    }, 3000);
}

function updateStats() {
    processedCount += Math.floor(Math.random() * 5) + 1;
    discoveryCount += Math.floor(Math.random() * 3);
    habitableCount += Math.floor(Math.random() * 2);
    anomalyCount += Math.floor(Math.random() * 2);
    
    document.getElementById('live-processed').textContent = processedCount.toLocaleString();
    document.getElementById('discoveries-today').textContent = discoveryCount;
    document.getElementById('habitable-found').textContent = habitableCount;
    document.getElementById('anomalies-detected').textContent = anomalyCount;
}

function addNewDiscovery() {
    const discoveries = [
        'Kepler-442b confirmed as potentially habitable',
        'TESS-1234c detected with 0.8 R‚äï radius',
        'K2-456b shows unusual transit pattern',
        'Kepler-789d has 365-day orbital period',
        'TESS-567e shows deep transit signal',
        'K2-890f detected in habitable zone',
        'Kepler-123g has Earth-like radius',
        'TESS-456h shows multi-planet system'
    ];
    
    const statuses = ['HABITABLE', 'CANDIDATE', 'ANOMALY', 'CONFIRMED'];
    
    const discoveryFeed = document.getElementById('discovery-feed');
    const newDiscovery = document.createElement('div');
    newDiscovery.className = 'discovery-item';
    newDiscovery.innerHTML = `
        <span class="discovery-time">now</span>
        <span class="discovery-text">${discoveries[Math.floor(Math.random() * discoveries.length)]}</span>
        <span class="badge bg-${Math.random() > 0.5 ? 'success' : 'info'}">${statuses[Math.floor(Math.random() * statuses.length)]}</span>
    `;
    
    discoveryFeed.insertBefore(newDiscovery, discoveryFeed.firstChild);
    
    // Keep only last 5 discoveries
    while (discoveryFeed.children.length > 5) {
        discoveryFeed.removeChild(discoveryFeed.lastChild);
    }
}

function populateBatchTable() {
    const tableBody = document.getElementById('batch-processing-table');
    tableBody.innerHTML = '';
    
    sampleCandidates.forEach(candidate => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><span class="badge bg-primary">${candidate.mission}</span></td>
            <td><code>${candidate.id}</code></td>
            <td>${candidate.period}</td>
            <td>${candidate.radius}</td>
            <td><span class="badge bg-${candidate.status === 'Completed' ? 'success' : 'warning'}">${candidate.status}</span></td>
            <td>${(candidate.confidence * 100).toFixed(1)}%</td>
            <td>${candidate.time}</td>
            <td><span class="badge bg-${candidate.result === 'Confirmed' ? 'success' : candidate.result === 'Habitable' ? 'info' : 'secondary'}">${candidate.result}</span></td>
        `;
        tableBody.appendChild(row);
    });
}

function updateBatchTable() {
    const tableBody = document.getElementById('batch-processing-table');
    const rows = tableBody.querySelectorAll('tr');
    
    // Update existing rows
    rows.forEach(row => {
        const statusCell = row.cells[4];
        const confidenceCell = row.cells[5];
        const timeCell = row.cells[6];
        const resultCell = row.cells[7];
        
        if (Math.random() > 0.7) {
            statusCell.innerHTML = '<span class="badge bg-success">Completed</span>';
            confidenceCell.textContent = (Math.random() * 0.3 + 0.7).toFixed(1) + '%';
            timeCell.textContent = (Math.random() * 2 + 1).toFixed(1) + 's';
            
            const results = ['Confirmed', 'Candidate', 'Habitable', 'False Positive'];
            const result = results[Math.floor(Math.random() * results.length)];
            const colors = ['success', 'warning', 'info', 'danger'];
            const color = colors[results.indexOf(result)];
            resultCell.innerHTML = `<span class="badge bg-${color}">${result}</span>`;
        }
    });
}

function startProcessing() {
    alert('üöÄ Processing started! Real-time analysis is now active.');
    startRealTimeUpdates();
}

function pauseProcessing() {
    alert('‚è∏Ô∏è Processing paused. Data collection continues in background.');
    clearInterval(processingInterval);
}

function downloadData() {
    alert('üì• Downloading latest processed data...');
    // Simulate download
    setTimeout(() => {
        alert('‚úÖ Download complete! 2.3 GB of processed data downloaded.');
    }, 2000);
}

function resetSystem() {
    if (confirm('‚ö†Ô∏è Are you sure you want to reset the system? This will clear all data.')) {
        alert('üîÑ System reset complete. All counters reset to zero.');
        processedCount = 0;
        discoveryCount = 0;
        habitableCount = 0;
        anomalyCount = 0;
        updateStats();
    }
}
</script>
{% endblock %}
